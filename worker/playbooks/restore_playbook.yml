---
- name: Restore router configuration
  hosts: all
  gather_facts: no

  vars:
    ansible_network_os: cisco.ios.ios
    ansible_user: "{{ router_user }}"
    ansible_password: "{{ router_pass }}"
    ansible_connection: ansible.netcommon.network_cli

  tasks:
    - name: Create a temporary file with the config content
      ansible.builtin.copy:
        content: "{{ config_content }}"
        dest: "/tmp/restore_config_{{ inventory_hostname }}.tmp"
      register: temp_file

    - name: Restore configuration from the temporary file
      cisco.ios.ios_config:
        # ใช้ src เพื่ออ่านจากไฟล์
        src: "{{ temp_file.dest }}"
        state: replaced # <--- เพิ่มบรรทัดนี้ เพื่อสั่งให้แทนที่ Configuration ทั้งหมด
      register: restore_result

    - name: Clean up the temporary file
      ansible.builtin.file:
        path: "{{ temp_file.dest }}"
        state: absent